@prefix gx: <https://registry.lab.gaia-x.eu/development/api/trusted-shape-registry/v1/shapes/jsonld/trustframework#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix sh: <http://www.w3.org/ns/shacl#> .
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .
@prefix merlot: <http://w3id.org/gaia-x/merlot#> .
@prefix skos: <http://www.w3.org/2004/02/skos/core#> .
@prefix vcard: <http://www.w3.org/2006/vcard/ns#> .

# Tagus/Loire base
merlot:MerlotLegalParticipantShape
    a sh:NodeShape ;
    sh:targetClass merlot:MerlotLegalParticipant ;
    sh:property
        # Tagus base
        [
            sh:path gx:legalRegistrationNumber ;
            sh:node gx:legalRegistrationNumberShape ;
            sh:minCount 1 ;
        ],
        [
            sh:path gx:parentOrganization ;
            sh:node gx:LegalParticipantShape ;
        ],
        [
            sh:path gx:subOrganization ;
            sh:node gx:LegalParticipantShape ;
        ],
        [
            sh:path gx:headquarterAddress ;
            sh:minCount 1 ;
            sh:node gx:PostalAddressShape ;
        ],
        [
            sh:path gx:legalAddress ;
            sh:minCount 1 ;
            sh:node gx:PostalAddressShape ;
        ],
        # Loire development base
        #[   sh:class gx:LegalPerson ;
        #    sh:description "A list of resolvable links to Gaia-X Credentials of participants that this entity is a subOrganization of, if any." ;
        #    sh:nodeKind sh:IRI ;
        #    sh:order 3 ;
        #    sh:path gx:parentOrganizationOf 
        #],
        [   sh:class vcard:Address ;
            sh:description "The full legal address of the organization." ;
            sh:maxCount 1 ;
            sh:minCount 1 ;
            sh:name "legal address" ;
            sh:nodeKind sh:BlankNodeOrIRI ;
            sh:order 1 ;
            sh:path gx:loireLegalAddress  # prefixed with loire to avoid issues with the same path from tagus
        ],
        [   sh:class vcard:Address ;
            sh:description "Full physical location of the headquarter of the organization." ;
            sh:maxCount 1 ;
            sh:minCount 1 ;
            sh:nodeKind sh:BlankNodeOrIRI ;
            sh:order 2 ;
            sh:path gx:loireHeadquartersAddress  ## prefixed with loire to avoid issues with the same path from tagus
        ],
        #[   sh:class gx:LegalPerson ;
        #    sh:description "A list of resolvable links to Gaia-X Credentials of participants with a legal mandate on this entity, e.g., as a subsidiary." ;
        #    sh:nodeKind sh:IRI ;
        #    sh:order 4 ;
        #    sh:path gx:subOrganisationOf 
        #],
        [   sh:datatype xsd:string ;
            sh:description "A human readable name of the entity." ;
            sh:maxCount 1 ;
            sh:name "name" ;
            sh:order 5 ;
            sh:path gx:name 
        ],
        #[   sh:description "Country's registration number, which identifies one specific entity. Valid formats are local, EUID, EORI, vatID, leiCode." ;
        #    sh:minCount 1 ;
        #    sh:name "registration number" ;
        #    sh:or ( [ sh:class gx:LocalRegistrationNumber ] [ sh:class gx:VatID ] [ sh:class gx:LeiCode ] [ sh:class gx:EORI ] [ sh:class gx:EUID ] ) ;
        #    sh:order 0 ;
        #    sh:path gx:registrationNumber 
        #],
        #[   sh:datatype xsd:string ;
        #    sh:description "A free text description of the entity." ;
        #    sh:maxCount 1 ;
        #    sh:name "description" ;
        #    sh:order 6 ;
        #    sh:path gx:description 
        #]
        # MERLOT specific
        [   sh:datatype xsd:string ;
            sh:description "Legal name of the entity." ;
            sh:maxCount 1 ;
            sh:name "legal name" ;
            sh:order 5 ;
            sh:path merlot:legalName 
        ],
        [
            sh:path merlot:termsAndConditions ;
            sh:minCount 1 ;
            sh:node merlot:ParticipantTermsAndConditions ;
        ],
        [   skos:example "'L.L.C, GmbH'" ;
            sh:datatype xsd:string ;
            sh:description "Rechtsform"@de,
                "Legal form"@en ;
            sh:in ( "LLC" "Corporation" "Limited partnership (LP)" "Nonprofit corporation" "Gesellschaft mit beschränkter Haftung (GmbH)" "Aktiengesellschaft (AG)" "Einzelunternehmen" "Gesellschaft bürgerlichen Rechts (GbR)" "Offene Handelsgesellschaft (OHG)" "Kommanditgesellschaft (KG)" "Unternehmergesellschaft (haftungsbeschränkt)" "Sole Trader" "Unincorporated Association" "Partnership" "Limited Partnership" "Trust" "Limited Company" "Limited Liability Partnership (LLP)" "Community Interest Company (CIC)" "Charitable Incorporated Organisation (CIO)" "Co-operative Society (Co-op)" "Community Benefit Society (BenCom)" "other" ) ;
            sh:maxCount 1 ;
            sh:name "Rechtsform" ;
            sh:order 9 ;
            sh:path merlot:legalForm 
        ] .

# MERLOT specific
merlot:ParticipantTermsAndConditionsShape
    a sh:NodeShape ;
    sh:targetClass merlot:ParticipantTermsAndConditions ;
    sh:property
        [
            sh:path merlot:URL ;
            sh:name "URL" ;
            sh:description "a resolvable link to document" ;
            sh:minCount 1 ;
            sh:maxCount 1 ;
            sh:datatype xsd:string
        ] ;
    sh:property
        [
            sh:path merlot:hash ;
            sh:name "hash" ;
            sh:minCount 1 ;
            sh:maxCount 1 ;
            sh:description "sha256 hash of the above document." ;
            sh:datatype xsd:string
        ] .

# Loire development base
vcard:Address a sh:NodeShape ;
    sh:closed false ;
    sh:description "Full address of the entity." ;
    sh:ignoredProperties ( rdf:type ) ;
    sh:property [ sh:description "Country code in ISO 3166-1 alpha2, alpha-3 or numeric format." ;
            sh:maxCount 1 ;
            sh:minCount 1 ;
            sh:or ( [ sh:in ( "AF" "EG" "AX" "AL" "DZ" "VI" "UM" "AS" "AD" "AO" "AI" "AQ" "AG" "GQ" "SY" "AR" "AM" "AW" "AZ" "ET" "AU" "BS" "BH" "BD" "BB" "BE" "BZ" "BJ" "BM" "BT" "VE" "BQ" "BA" "BW" "BV" "BR" "VG" "IO" "BN" "BG" "BF" "BI" "CV" "CL" "CN" "CK" "CR" "CI" "CW" "DK" "CD" "KP" "LA" "DE" "DM" "DO" "DJ" "EC" "MK" "SV" "ER" "EE" "FK" "FO" "FJ" "FI" "FM" "FR" "TF" "GF" "PF" "GA" "GM" "GE" "GH" "GI" "GD" "GR" "GL" "GP" "GU" "GT" "GG" "GN" "GW" "GY" "HT" "HM" "HN" "HK" "IN" "ID" "IM" "IQ" "IE" "IR" "IS" "IL" "IT" "JM" "JP" "YE" "JE" "JO" "KY" "KH" "CM" "CA" "KZ" "QA" "KE" "KG" "KI" "CC" "CO" "KM" "CG" "HR" "CU" "KW" "LS" "LV" "LB" "LR" "LY" "LI" "LT" "LU" "MO" "MG" "MW" "MY" "MV" "ML" "MT" "MP" "MA" "MH" "MQ" "MR" "MU" "YT" "MX" "MC" "MN" "MS" "ME" "MZ" "MM" "NA" "NR" "NP" "NC" "NZ" "NI" "NL" "NE" "NG" "NU" "NF" "False" "OM" "AT" "PK" "PW" "PS" "PA" "PG" "PY" "PE" "PH" "PN" "BO" "PL" "PT" "PR" "KR" "MD" "RE" "RW" "RO" "RU" "SB" "ZM" "WS" "SM" "ST" "SA" "SE" "CH" "SN" "RS" "SC" "SL" "ZW" "SG" "SK" "SI" "SO" "ES" "LK" "BL" "SH" "KN" "LC" "MF" "SX" "PM" "VC" "ZA" "SD" "GS" "SS" "SR" "SJ" "SZ" "TJ" "TW" "TH" "TL" "TG" "TK" "TO" "TT" "TD" "CZ" "TN" "TR" "TM" "TC" "TV" "UG" "UA" "HU" "UY" "UZ" "VU" "VA" "AE" "TZ" "US" "GB" "VN" "WF" "CX" "BY" "EH" "CF" "CY" ) ] [ sh:in ( "AFG" "ALA" "ALB" "DZA" "ASM" "AND" "AGO" "AIA" "ATA" "ATG" "ARG" "ARM" "ABW" "AUS" "AUT" "AZE" "BHS" "BHR" "BGD" "BRB" "BLR" "BEL" "BLZ" "BEN" "BMU" "BTN" "BOL" "BES" "BIH" "BWA" "BVT" "BRA" "IOT" "BRN" "BGR" "BFA" "BDI" "KHM" "CMR" "CAN" "CPV" "CYM" "CAF" "TCD" "CHL" "CHN" "CXR" "CCK" "COL" "COM" "COG" "COD" "COK" "CRI" "CIV" "HRV" "CUB" "CUW" "CYP" "CZE" "DNK" "DJI" "DMA" "DOM" "ECU" "EGY" "SLV" "GNQ" "ERI" "EST" "ETH" "FLK" "FRO" "FJI" "FIN" "FRA" "GUF" "PYF" "ATF" "GAB" "GMB" "GEO" "DEU" "GHA" "GIB" "GRC" "GRL" "GRD" "GLP" "GUM" "GTM" "GGY" "GIN" "GNB" "GUY" "HTI" "HMD" "VAT" "HND" "HKG" "HUN" "ISL" "IND" "IDN" "IRN" "IRQ" "IRL" "IMN" "ISR" "ITA" "JAM" "JPN" "JEY" "JOR" "KAZ" "KEN" "KIR" "PRK" "KOR" "KWT" "KGZ" "LAO" "LVA" "LBN" "LSO" "LBR" "LBY" "LIE" "LTU" "LUX" "MAC" "MKD" "MDG" "MWI" "MYS" "MDV" "MLI" "MLT" "MHL" "MTQ" "MRT" "MUS" "MYT" "MEX" "FSM" "MDA" "MCO" "MNG" "MNE" "MSR" "MAR" "MOZ" "MMR" "NAM" "NRU" "NPL" "NLD" "NCL" "NZL" "NIC" "NER" "NGA" "NIU" "NFK" "MNP" "NOR" "OMN" "PAK" "PLW" "PSE" "PAN" "PNG" "PRY" "PER" "PHL" "PCN" "POL" "PRT" "PRI" "QAT" "SRB" "REU" "ROU" "RUS" "RWA" "BLM" "SHN" "KNA" "LCA" "MAF" "SPM" "VCT" "WSM" "SMR" "STP" "SAU" "SEN" "SYC" "SLE" "SGP" "SXM" "SVK" "SVN" "SLB" "SOM" "ZAF" "SGS" "SSD" "ESP" "LKA" "SDN" "SUR" "SJM" "SWZ" "SWE" "CHE" "SYR" "TWN" "TJK" "TZA" "THA" "TLS" "TGO" "TKL" "TON" "TTO" "TUN" "TUR" "XTX" "TKM" "TCA" "TUV" "UGA" "UKR" "ARE" "GBR" "USA" "UMI" "URY" "UZB" "VUT" "VEN" "VNM" "VGB" "VIR" "WLF" "ESH" "YEM" "ZMB" "ZWE" "XKX" ) ] [ sh:in ( "4" "818" "248" "008" "10" "850" "581" "14" "16" "20" "660" "8" "028" "226" "760" "26" "41" "231" "30" "36" "048" "40" "42" "46" "084" "204" "48" "52" "58" "60" "62" "092" "086" "854" "108" "132" "152" "156" "184" "188" "384" "531" "208" "180" "408" "418" "276" "212" "214" "262" "218" "807" "222" "232" "233" "238" "234" "242" "246" "583" "250" "260" "254" "258" "266" "270" "268" "288" "292" "308" "300" "304" "312" "316" "320" "831" "324" "624" "328" "332" "334" "340" "344" "356" "360" "833" "368" "372" "364" "352" "376" "380" "388" "392" "887" "832" "400" "136" "116" "120" "124" "398" "634" "404" "417" "296" "166" "170" "174" "178" "191" "192" "414" "426" "428" "422" "430" "434" "438" "440" "442" "446" "450" "454" "458" "462" "466" "470" "580" "504" "584" "474" "478" "480" "175" "484" "492" "496" "500" "499" "508" "104" "516" "520" "524" "540" "554" "558" "528" "562" "566" "570" "574" "578" "512" "32" "586" "585" "275" "591" "598" "600" "604" "608" "612" "068" "616" "620" "630" "410" "498" "638" "646" "642" "643" "090" "894" "882" "674" "678" "682" "752" "756" "686" "688" "690" "694" "716" "702" "703" "705" "706" "724" "144" "652" "654" "659" "662" "663" "534" "666" "670" "710" "729" "239" "728" "740" "744" "748" "762" "158" "764" "626" "768" "772" "776" "780" "148" "203" "788" "792" "795" "796" "798" "800" "804" "348" "858" "860" "548" "336" "784" "834" "840" "826" "704" "876" "162" "112" "732" "140" "196" ) ] ) ;
            sh:order 0 ;
            sh:path gx:countryCode ],
        [ sh:datatype xsd:string ;
            sh:description "String of a street-address" ;
            sh:maxCount 1 ;
            sh:order 3 ;
            sh:path vcard:postal-code ],
        [ sh:datatype xsd:string ;
            sh:description "The v:locality property specifies the locality (e.g., city) of a postal address." ;
            sh:maxCount 1 ;
            sh:order 4 ;
            sh:path vcard:locality ],
        [ sh:datatype xsd:string ;
            sh:description "the street address of a postal address" ;
            sh:maxCount 1 ;
            sh:order 2 ;
            sh:path vcard:street-address ] ;
        # gps not required from business
        #[ sh:class gx:GPSLocation ;
        #    sh:description "GPS in ISO 6709:2008/Cor 1:2009 format." ;
        #    sh:nodeKind sh:BlankNodeOrIRI ;
        #    sh:order 1 ;
        #    sh:path gx:gps ] ;
    sh:targetClass vcard:Address .

gx:legalRegistrationNumberShape
    a sh:NodeShape ;
    sh:targetClass gx:legalRegistrationNumber ;
    sh:message "At least one of taxID, vatID, EUID, EORI or leiCode must be defined." ;
    sh:property
        [
            sh:path gx:taxID ;
            sh:datatype xsd:string ;
            sh:minLength 3 ;
        ] ;
    sh:property
        [
            sh:path gx:EUID ;
            sh:datatype xsd:string ;
            sh:minLength 3 ;
        ] ;
    sh:property
        [
            sh:path gx:EORI ;
            sh:datatype xsd:string ;
            sh:minLength 3 ;
        ] ;
    sh:property
        [
            sh:path gx:vatID ;
            sh:datatype xsd:string ;
            sh:minLength 3 ;
        ] ;
    sh:property
        [
            sh:path gx:leiCode ;
            sh:datatype xsd:string ;
            sh:minLength 3 ;
        ] ;
    sh:or
        (
            [
                sh:path gx:taxID ;
                sh:minCount 1 ;
            ] [
                  sh:path gx:EUID ;
                  sh:minCount 1 ;
              ] [
                    sh:path gx:EORI ;
                    sh:minCount 1 ;
                ] [
                      sh:path gx:vatID ;
                      sh:minCount 1 ;
                  ]
            [
                sh:path gx:leiCode ;
                sh:minCount 1 ;
            ]
        ) .

gx:PostalAddressShape
    a sh:NodeShape ;
    sh:targetClass gx:headquarterAddress, gx:legalAddress ;
    sh:property
        [
            sh:path gx:countrySubdivisionCode ;
            sh:datatype xsd:string ;
            sh:minCount 1 ;
            sh:pattern "^[a-zA-Z]{2}-(?:[a-zA-Z]{1,3}|[0-9]{1,3})$" ;
            sh:flags "i" ;
            sh:message "an ISO 3166-2 format value is expected." ;
        ] .